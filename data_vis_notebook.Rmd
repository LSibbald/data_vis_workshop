---
title: "Data_Visualisation_Workshop"
output: html_document
date: "2023-04-26"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Set-up
```{r}
# list of packages to check and install if not installed
packages <- c("tidyverse", "psych")

# install packages that are not yet installed and load them
# loop over packages in the packages list
for (package in packages){
  # save a "TRUE" if the package is installed, save a "FALSE" when a package is not installed
  installed <- require(package, character.only = TRUE)
  # if the package is not installed, install it
  if (!installed){
    install.packages(package, dependencies = TRUE)
  }
  # load packages
  library(package, character.only = TRUE)
}
```

### Histogram plot
```{r}
# first load a dataset from the psych package
# this dataset contains self-report data on the big five inventory and some extra variables
data(bfi)

# View the first few rows of the dataset
head(bfi)
```
Maybe you would like to plot the distribution of age using a histogram, we can use ggplot2 for that. This package is build in the tidyverse package we loaded/installed earlier.
For all plots in ggplot you first need to specify the mapping, which is done in the ggplot function, after that, you add your graph. In this case a histogram.
For a detailed description see http://vissoc.co/makeplot.html#how-ggplot-works

```{r}
# basic histogram
ggplot(data = bfi, mapping = aes(x=age)) +
  geom_histogram()
```
This results in a plot, but it not the pretty plot you would put in a paper maybe.
luckily, ggplot has a lot of options to adjust your plot to your wishes. For example, you can make use of the build in themes of ggplot.
These can be found on https://ggplot2.tidyverse.org/reference/ggtheme.html

```{r}
ggplot(data = bfi, mapping = aes(x=age)) +
  # I specified the argument binwidth to make bins of 1 "age" so that each bar 
  #represents an age value
  geom_histogram(fill = "gray40", color = "black", binwidth = 1) +
  # and added a theme
  theme_bw() +
  # you could also add titles:
  labs(title = "Age Distribution", x = "Age", y = "Count") 
```
I recommend googling what you want to do with your graph, many people use ggplot and posted a question on stackoverflow (a website where people post their programming questions).
Next to this you can also ask ChatGPT for help and look at the ggplot cheatsheet https://posit.co/resources/cheatsheets/?type=posit-cheatsheets&_page=2/

For example, I have asked ChatGPT to create an APA style histogram plot. It was not perfect though, so I added things myself.

```{r}
ggplot(data = bfi, mapping = aes(x = age)) +
  # specify the filling color of the bars, the border color and how wide you
  #bins are so that each bar is a specific age
  geom_histogram(fill = "gray40", color = "black", binwidth = 1) +
  # add titles
  labs(title = "Age Distribution", x = "Age", y = "Count") +
  # add a theme, this makes it easier to adjust your graph in one go
  #using pre-specified themes in ggplot
  # base size here means font size, its set to 12
  theme_bw(base_size = 12) +
  # put the graph title in the middle of the graph, specify font size and make it bold
  theme(plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
  # do similar things to the x axis title
  axis.title.x = element_text(size = 12, face = "bold"),
  # again for the y axis title
  axis.title.y = element_text(size = 12, face = "bold"),
  # specify tick text size
  axis.text = element_text(size = 10),
  # delete the minor grid (APA style is often without a grid)
  panel.grid.minor = element_blank(),
  # delete the border of the graph panel
  panel.border = element_blank(),
  # also delete the major graph grid, google to find out what it is
  panel.grid.major = element_blank(),
  # you do need an axis line, so you specify it here
  axis.line = element_line(color = "black", size = 0.5),
  # remove legend
  legend.position = "none") +
  # make sure the x-axis starts at 0
  scale_x_continuous(expand = c(0,0)) +
  # make sure the graph has no white space beneath the bars
  scale_y_continuous(expand = c(0,0))
```
This might look a bit extensive, but my intention was to show that ggplot allows you to have almost complete control over your graph aesthetics, which is nice :).

### Scatter plot
We will use the same dataset to create a scatterplot, but it would be nice to use the sum scores per big five trait, so we will first do that.
```{r}
# the %>% symbol is from the tidyverse package, its called a pipe and takes all objects before the pipe and takes it down the pipe
bfi <- bfi %>%
# let's compute total summary scores for Agreeableness, Conscientiousness, Extraversion, Neuroticism, and Openness by sum five columns together for each of this personality traits:
  # first replace all the missing observations by 0
 replace(is.na(.), 0) %>%
  # add columns that represent the sum scores by summing over specific rows
   mutate(
    sum_agree = rowSums(.[1:5]),
    sum_consc = rowSums(.[6:10]),
    sum_extra = rowSums(.[11:15]),  
    sum_neuro = rowSums(.[16:20]),  
    sum_open = rowSums(.[21:25]))
```

Now that we have the sumscores we can use them for plots. For example, we can plot the sum score of Extraversion and Openness

```{r}
ggplot(data = bfi, mapping = aes(x=sum_extra, y=sum_open)) + 
    geom_point()
```
Again we get this ugly plot, so lets make it nicer

```{r}
# create mapping
ggplot(data = bfi, mapping = aes(x=sum_extra, y=sum_open)) + 
  # add the type of graph
  geom_point() +
  # add a theme
  theme_classic() +
  # add labels
  labs(x = "Extraversion", y = "Openness")
```
You could even change the dot color and size based on another variable.
For example, change the color based on education. For that we first need to make education a factor variable.

```{r}
bfi <- bfi %>%
  # change the variable type
  mutate (education=as.factor(education)) %>% 
  # recode the values based on the labels that you can find by typing help(bfi) in your R console
  mutate (education = recode_factor (education,
  '0'='Missing',                                  
  '1' = 'HS', 
  '2' = 'finished HS', 
  '3' = 'some college', 
  '4' = 'college graduate', 
  '5' = 'graduate degree'))
```

Now we can plot:
```{r}
# create mapping and add that the dot color should depend on education
ggplot(data = bfi, mapping = aes(x=sum_extra, y=sum_open, color=education)) + 
  # add the type of graph
  geom_point() +
  # add a theme
  theme_classic() +
  # add labels
  labs(x = "Extraversion", y = "Openness") +
  # change legend title (how to do this depends on your graph, so google this)
  scale_color_discrete("Education Type")
```

Now the colors com from a default scale, but you can also use different build in scales: http://www.sthda.com/english/wiki/ggplot2-colors-how-to-change-colors-automatically-and-manually). Note: there are also colorblind-friendly palettes available. See http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/

```{r}
# create mapping and add that the dot color should depend on education
ggplot(data = bfi, mapping = aes(x=sum_extra, y=sum_open, color=education)) + 
  # add the type of graph
  geom_point() +
  # add a theme
  theme_classic() +
  # add labels
  labs(x = "Extraversion", y = "Openness") +
  # change legend title (how to do this depends on your graph, so google this)
  scale_color_discrete("Education Type") +
  # add a different color palette
  scale_color_brewer(palette="Dark2")
```
```{r}
# create mapping and add that the dot color should depend on education
ggplot(data = bfi, mapping = aes(x=sum_extra, y=sum_open, color=education)) + 
  # add the type of graph
  geom_point() +
  # add a theme
  theme_classic() +
  # add labels
  labs(x = "Extraversion", y = "Openness") +
  # change legend title (how to do this depends on your graph, so google this)
  scale_color_discrete("Education Type") +
  # manually specify the colors
  scale_color_manual(values = c("red", "blue", "green", "yellow", "pink", "grey")) # you can also use color codes, see google
```
however: do note that yellow to this white background is not really nice, but this was for illustration purposes. 

Next to the color of the dots, you can also make the size of the dots depended on another variable's value.
```{r}
# create mapping and add that the dot size should depend on age
ggplot(data = bfi, mapping = aes(x=sum_extra, y=sum_open, size=age)) + 
  # add the type of graph
  geom_point() +
  # add a theme
  theme_classic() +
  # add labels
  labs(x = "Extraversion", y = "Openness") +
  # change legend title (how to do this depends on your graph/aesthetics, so google this) 
  scale_size_continuous("Age")

```

### Heatmap plot

Upon popular request we will also cover heatmap plots. You often use them when you have many values to show, and low to high matters in this case. for example, you want to visualize a correlation matrix. We can also use ggplot to create these graphs.

The hard thing with these graphs is that data needs to be in a very specific format. Maybe you have created a correlation matrix like the build in Harman.Burt correlation matrix from the psych package:

```{r}
# load data
data("Harman")

# inspect data
head(Harman.Burt)
```
However: for the plot, you need data like this: 
```{r}
# dummy data
x <- LETTERS[1:20]
y <- paste0("var", seq(1,20))
data <- expand.grid(X=x, Y=y)
data$Z <- runif(400, 0, 5)

head(data)
```
So, we need to transform our "wide" correlation to "long".

```{r}
# convert the correlation matrix into a "long" format using tidyr::pivot_longer() (from the tidyverse package)
Harman_long <- Harman.Burt %>%
  # first make the matrix a dataframe to perform actions
  as.data.frame() %>% 
  # make the rownames into a column and call it Var1 (name does not matter in this case)
  rownames_to_column(var = "Var1") %>% 
  # get long format
  pivot_longer(cols = -Var1, names_to = "Var2", values_to = "Correlation")

# inspect dataframe
head(Harman_long)
```
When plotting the most basic heatmap we get this:
```{r}
# create mapping
ggplot(data = Harman_long, aes(x = Var1, y = Var2, fill = Correlation)) +
  # create heatmap
  geom_tile() 
```
Of course we can tweak it a bit. Var1 and Var2 have no meaning here for example, so we can leave it out. Also the colorscale could be more informative. Next to that maybe you like to be able to see the actual correlations.

```{r}
# create mapping
ggplot(data = Harman_long, aes(x = Var1, y = Var2, fill = Correlation)) +
  # create heatmap and include black lines between the tiles
  geom_tile(color="black") +
  # delete x and y axis labels
  labs(x=NULL, y=NULL) +
  # change color scheme, make the lowerpoint of the colors/legend 0
  scale_fill_gradient2(low = "white", high = "red", mid = "orange", midpoint = 0.5, 
                       limits = c(0, 1)) +
  # remove the grid panels in the back and make the background white
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  # add the correlation values to the plot, specify text color and size
  geom_text(aes(label = round(Correlation, 2)), color = "black", size=3)
  
```
### Export Your Graphs

After creating your graph, you might also want to export it to a place on your computer so you can use it somewhere else.
Say you want to store the heatmap plot I just created above. First you have to think of a name and a place on your computer where you want to store it.

```{r}
# create mapping and store graph in a ggplot graph object called "test_heatmap"
test_heatmap = ggplot(data = Harman_long, aes(x = Var1, y = Var2, fill = Correlation)) +
  # create heatmap and include black lines between the tiles
  geom_tile(color="black") +
  # delete x and y axis labels
  labs(x=NULL, y=NULL) +
  # change color scheme, make the lowerpoint of the colors/legend 0
  scale_fill_gradient2(low = "white", high = "red", mid = "orange", midpoint = 0.5, 
                       limits = c(0, 1)) +
# remove the grid panels in the back and make the background white
  theme(panel.background = element_rect(fill = "white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  # add the correlation values to the plot, specify text color and size
  geom_text(aes(label = round(Correlation, 2)), color = "black", size=3)
```

Now save your plot:
```{r}
# state the name of your image, include the graph object and specify the desired location. Ofcourse replace my path
#with you own path. 
ggsave(filename = "heatmap.jpeg", plot = test_heatmap, path = "C:/Users/lsibbald/Documents/DataVisWorkshop")
```
Now it is saved! However, it could be that you're not happy with the current dimensions of the image.
Luckily, it is possible to adjust the height and width of your image.

```{r}
# state the name of your image, include the graph object and specify the desired location. Ofcourse replace my path
#with you own path. Include the height/width of your image + provide units="cm"
ggsave(filename = "heatmap.jpeg", plot = test_heatmap, path = "C:/Users/lsibbald/Documents/DataVisWorkshop",
			 width = 20, height = 10, units = "cm")
```

#### final notes:

In this notebook we only covered a few options of what is possible in ggplot.
You can find more graphs at https://r-graph-gallery.com/ggplot2-package.html

I also recommend looking at the ggplot cheatsheet: https://posit.co/resources/cheatsheets/?type=posit-cheatsheets&_page=2/

Happy plotting!